[gd_scene load_steps=18 format=2]

[ext_resource path="res://Assets/Models/Meshes/Meshplant_04_Sporenpilz_state012.res" type="ArrayMesh" id=1]
[ext_resource path="res://Assets/Models/Meshes/Meshplant_04_Sporenpilz_state0117.res" type="SphereMesh" id=2]
[ext_resource path="res://Assets/Materials/Plants/ShroomStem.tres" type="Material" id=3]
[ext_resource path="res://Assets/Models/Meshes/Meshplant_04_Sporenpilz_state0113.res" type="QuadMesh" id=4]
[ext_resource path="res://Effects/SporeParticles.gd" type="Script" id=5]
[ext_resource path="res://Assets/Textures/spore_mask.png" type="Texture" id=7]

[sub_resource type="MultiMesh" id=25]
transform_format = 1
instance_count = 64
mesh = ExtResource( 4 )
transform_array = PoolVector3Array( -0.143109, -0.968851, -0.202108, 0.989266, -0.146125, 0, -0.0295331, -0.199939, 0.979363, -0.0119858, -0.29053, -0.0145405, -0.0890638, -0.995804, -0.0210266, 0.996024, -0.0890835, 0, -0.00187312, -0.020943, 0.999779, -0.0155722, -0.271675, -0.002995, -0.0208597, -0.995805, -0.0890882, 0.00186577, 0.0890687, -0.996024, 0.999781, -0.020943, 0, -0.0154555, -0.182574, -0.00156091, -0.0539984, 0.97786, 0.202172, 0.998479, 0.055137, 0, -0.0111471, 0.201864, -0.97935, 0.0149415, -0.196264, 0.0159112, 0, 0.808797, 0.588087, 1, 0, 0, 0, 0.588087, -0.808797, 0.00883737, -0.226111, 0.0342351, 0.0185932, -0.951175, 0.308092, 0.999809, 0.0195438, 0, -0.0060213, 0.308033, 0.951357, -0.013358, -0.21377, 0.0248901, 0.0207379, -0.735355, -0.677365, 0.999603, 0.02819, 0, 0.0190949, -0.677096, 0.735647, -0.00707493, -0.218554, -0.0361386, -0.109027, -0.993496, -0.0328333, -0.0112197, 0.034258, -0.99935, 0.993975, -0.108588, -0.0148818, -0.0167073, -0.209131, -0.0079079, -0.437014, -0.898735, -0.0359711, -0.0585221, 0.0683185, -0.995946, 0.897549, -0.433137, -0.082452, -0.0117438, -0.202979, -0.0276258, 0.0592421, -0.927983, 0.367882, 0.997968, 0.0637099, 0, -0.0234377, 0.367135, 0.929873, -0.0121302, -0.196416, 0.0255795, 0.0194186, -0.929848, 0.367431, 0.999782, 0.0208791, 0, -0.00767163, 0.367351, 0.930051, -0.0126931, -0.217236, 0.0267968, 0.510008, 0.859568, 0.0321683, -0.0609067, 0.073391, -0.995442, -0.85801, 0.505724, 0.0897835, 0.00963661, -0.203146, 0.0316313, 0.367705, -0.929943, 0, 0, 0, -1, 0.929943, 0.367705, 0, -0.0129585, -0.231985, 0.0264616, 0.255768, -0.965814, 0.0422637, -0.051831, -0.0573546, -0.997008, 0.965348, 0.252812, -0.0647286, -0.0141575, -0.260653, 0.0190781, -0.507948, -0.861129, -0.0211191, -0.0401391, 0.0481532, -0.998033, 0.860452, -0.506101, -0.0590242, -0.00976035, -0.213286, -0.0324457, 0.0878151, -0.803648, -0.58859, 0.994083, 0.108624, 0, 0.063935, -0.585107, 0.808432, -0.0080896, -0.187614, -0.0313614, 0.434329, 0.900678, -0.0117239, 0.0191172, -0.02223, -0.99957, -0.900552, 0.433918, -0.0268736, 0.0119958, -0.235316, 0.0286314, -0.156473, -0.98546, -0.0662184, -0.0349641, 0.0725289, -0.996753, 0.987063, -0.15365, -0.0458045, -0.0151786, -0.18958, -0.0118407, 0.0207327, 0.734336, 0.67847, 0.999602, -0.0282221, 0, 0.0191478, 0.6782, -0.734628, 0.00720767, -0.23314, 0.0361711, -0.0517796, 0.992742, -0.108543, 0.998643, 0.0520873, 0, 0.00565372, -0.108396, -0.994092, 0.0162755, -0.198943, -0.00776154, 0.588087, -0.808797, 0, 0, 0, -1, 0.808797, 0.588087, 0, -0.00839945, -0.231654, 0.0348374, -0.20208, 0.979259, 0.0146574, 0.0147259, 0.0180027, -0.99973, -0.979258, -0.20181, -0.0180585, 0.0155799, -0.219534, -0.0172062, -0.442781, 0.894877, 0.056033, 0.116146, 0.119211, -0.986052, -0.889075, -0.430097, -0.156721, 0.0102818, -0.184678, -0.0270796, -0.0176322, -0.979259, -0.201843, 0.999838, -0.0180027, 0, -0.00363371, -0.20181, 0.979418, -0.0156416, -0.236248, -0.0169167, -0.0924119, -0.983669, 0.154453, 0.995616, -0.0935343, 0, 0.0144467, 0.153776, 0.988, -0.014771, -0.270963, 0.0120655, -0.262864, -0.959924, -0.0972034, -0.0896032, 0.124599, -0.988153, 0.960663, -0.251041, -0.118765, -0.0131962, -0.177378, -0.0163952, 0.018006, 0.967239, 0.253229, 0.999827, -0.0186126, 0, 0.00471325, 0.253185, -0.967406, 0.0144843, -0.237473, 0.0216315, 0.679836, -0.733253, 0.0127745, -0.0433104, -0.0575316, -0.997404, 0.732084, 0.677517, -0.0708695, -0.00671962, -0.248812, 0.0357615, -0.040259, -0.900001, -0.434025, 0.999001, -0.0446875, 0, -0.0193955, -0.433591, 0.900901, -0.0108973, -0.247741, -0.0299883, -0.0908087, -0.989921, -0.108672, 0.995819, -0.0913497, 0, -0.00992712, -0.108217, 0.994078, -0.0151451, -0.270505, -0.00972548, 0.43639, 0.899038, -0.0359711, 0.0585695, -0.0682779, -0.995946, -0.897849, 0.432514, -0.082452, 0.0109867, -0.25796, 0.0284037, 0, 0.967406, 0.253229, 1, 0, 0, 0, 0.253229, -0.967406, 0.0150311, -0.22544, 0.0198924, 0.312042, 0.948329, 0.0574667, -0.0656618, 0.0818689, -0.994478, -0.947797, 0.306545, 0.0878155, 0.0127816, -0.194009, 0.0233653, -0.0878151, 0.803648, 0.58859, 0.994083, 0.108624, 0, -0.063935, 0.585107, -0.808432, 0.00784318, -0.187081, 0.0316009, 0.380476, 0.920912, -0.0846082, 0.115823, -0.138221, -0.983606, -0.917509, 0.364439, -0.159252, 0.0108099, -0.282587, 0.0222977, -0.110741, 0.854989, -0.506686, 0.991716, 0.12845, 0, 0.0650837, -0.502489, -0.862131, 0.00957823, -0.178715, -0.02688, 0.0364569, -0.966694, -0.253326, 0.99929, 0.0376862, 0, 0.00954687, -0.253146, 0.967381, -0.01464, -0.206698, -0.019649, -0.254228, -0.9667, 0.0292961, 0.0275067, -0.0375063, -0.998918, 0.966753, -0.253147, 0.0361259, -0.0150308, -0.245347, -0.0187252, 0.0194186, -0.929848, 0.367431, 0.999782, 0.0208791, 0, -0.00767163, 0.367351, 0.930051, -0.0128739, -0.216145, 0.0262771, 0.038859, 0.929239, -0.367431, 0.999127, -0.0417816, 0, -0.0153518, -0.36711, -0.930051, 0.0129417, -0.246591, -0.0254668, 0.588414, -0.808521, -0.00787583, 0.0225253, 0.0261284, -0.999405, 0.808246, 0.587887, 0.0335865, -0.00839399, -0.218432, 0.0346341, -0.0217365, 0.998488, -0.0504965, -0.010662, -0.0507371, -0.998655, -0.999707, -0.0211688, 0.0117487, 0.0165051, -0.258131, -0.00308225, 0.202703, -0.978802, 0.0292961, -0.0294534, -0.0359977, -0.998918, 0.978797, 0.201621, -0.0361259, -0.0154124, -0.251408, 0.0158541, -0.253455, -0.967236, -0.0146574, -0.0137558, 0.0187544, -0.99973, 0.96725, -0.253184, -0.0180585, -0.0150369, -0.221229, -0.0197259, -0.0650573, 0.997341, -0.0328333, -0.0127212, -0.0337293, -0.99935, -0.997801, -0.0645973, 0.0148818, 0.0167292, -0.247557, -0.00734481, -0.154734, -0.987956, 0, 0, 0, -1, 0.987956, -0.154734, 0, -0.0164082, -0.228221, -0.0129659, -0.110492, 0.855021, 0.506686, 0.991753, 0.128162, 0, -0.0649378, 0.502508, -0.862131, 0.00946271, -0.178119, 0.0269241, -0.0648037, -0.997339, 0.0333919, 0.00505251, -0.0337897, -0.999416, 0.997885, -0.0645972, 0.00722877, -0.0171184, -0.242516, -0.0039763, -0.0648888, 0.997759, -0.0163081, -0.00648696, -0.0167639, -0.999838, -0.997871, -0.0647725, 0.00756021, 0.0170589, -0.241492, -0.00523946, 0.0878082, 0.804017, 0.588087, 0.994089, -0.108566, 0, 0.0638465, 0.584611, -0.808798, 0.00853794, -0.26126, 0.0320471, 0.0703844, -0.991583, 0.108672, 0.99749, 0.0708037, 0, -0.00769435, 0.108399, 0.994078, -0.0154975, -0.188178, 0.00850162, -0.507024, 0.861883, -0.00915841, -0.0225007, -0.0238569, -0.999462, -0.861638, -0.506545, 0.0314891, 0.00966443, -0.233524, -0.0330558, -0.0594065, -0.928197, -0.367317, 0.997958, -0.0638714, 0, -0.0234611, -0.366567, 0.930096, -0.0119724, -0.25573, -0.0266303, 0.26069, -0.962614, -0.0735828, 0.0904698, 0.100241, -0.990842, 0.961174, 0.251646, 0.113219, -0.0131095, -0.185349, 0.0199456, 0.103823, -0.924349, 0.367152, 0.993751, 0.111618, 0, -0.0409807, 0.364858, 0.930161, -0.011742, -0.179481, 0.0221626, 0.507948, 0.861129, 0.0211191, -0.0401391, 0.0481532, -0.998033, -0.860452, 0.506101, 0.0590243, 0.010352, -0.211413, 0.0312608, 0.4388, 0.89726, 0.0487707, -0.079253, 0.0927075, -0.992534, -0.895083, 0.431658, 0.111791, 0.0112538, -0.193923, 0.027145, -0.0778554, -0.948332, -0.307578, 0.996647, -0.0818219, 0, -0.0251666, -0.306547, 0.951523, -0.0133549, -0.262349, -0.0214679, -0.25934, -0.962618, -0.0781692, -0.0728569, 0.100208, -0.992296, 0.963034, -0.251646, -0.0961212, -0.0134528, -0.182802, -0.0176184, 0.4388, 0.89726, 0.0487707, -0.079253, 0.0927075, -0.992534, -0.895083, 0.431658, 0.111791, 0.011163, -0.191054, 0.0267174, -0.0214553, -0.998474, -0.0508788, 0.00109303, 0.050867, -0.998705, 0.999769, -0.0214831, 0, -0.0166561, -0.199899, -0.00109634, 0.0210553, 0.993633, -0.110685, -0.0023449, -0.11066, -0.993856, -0.999776, 0.0211855, 0, 0.0147824, -0.280438, 0.000793806, 0, -0.734628, -0.67847, 1, 0, 0, 0, -0.67847, 0.734628, -0.00678394, -0.225959, -0.0366475, 0.0336587, -0.997341, -0.0646341, 0.999431, 0.0337293, 0, 0.00218006, -0.0645973, 0.997909, -0.0167789, -0.204616, -0.00463586 )

[sub_resource type="Gradient" id=26]
offsets = PoolRealArray( 0, 0.120755, 0.74717, 1 )
colors = PoolColorArray( 0.592157, 0.0980392, 0.776471, 0, 0.596078, 0.109804, 0.784314, 1, 0.605256, 0.281536, 0.853851, 1, 0.611765, 0.364706, 0.886275, 0 )

[sub_resource type="GradientTexture" id=20]
gradient = SubResource( 26 )

[sub_resource type="Curve" id=21]
min_value = -200.0
max_value = 200.0
_data = [ Vector2( 0, 1 ), 0.0, 0.0, 0, 0, Vector2( 1, 1 ), 0.0, 0.0, 0, 0 ]

[sub_resource type="CurveTexture" id=22]
curve = SubResource( 21 )

[sub_resource type="Curve" id=6]
_data = [ Vector2( 0, 0.0352273 ), 0.0, 0.0, 0, 0, Vector2( 0.170139, 0.626136 ), 0.0, 0.0, 0, 0, Vector2( 0.520833, 0.8 ), 0.0, 0.0, 0, 0, Vector2( 0.986111, 0.498864 ), 0.0, 0.0, 0, 0 ]

[sub_resource type="CurveTexture" id=23]
curve = SubResource( 6 )

[sub_resource type="ParticlesMaterial" id=3]
emission_shape = 1
emission_sphere_radius = 3.0
spread = 180.0
gravity = Vector3( 0, 0, 0 )
linear_accel = 0.05
linear_accel_random = 1.0
radial_accel_curve = SubResource( 22 )
angle = 30.0
angle_random = 1.0
scale_curve = SubResource( 23 )
color_ramp = SubResource( 20 )
hue_variation = 0.05
hue_variation_random = 0.77

[sub_resource type="Shader" id=8]
code = "// NOTE: Shader automatically converted from Godot Engine 3.5.1.stable's SpatialMaterial.

shader_type spatial;
render_mode async_visible,blend_mix,depth_draw_opaque,cull_back,diffuse_burley,specular_schlick_ggx;
uniform vec4 albedo : hint_color;
uniform sampler2D texture_albedo : hint_albedo;
uniform float specular;
uniform float metallic;
uniform float roughness : hint_range(0,1);
uniform float point_size : hint_range(0,128);
uniform int particles_anim_h_frames;
uniform int particles_anim_v_frames;
uniform bool particles_anim_loop;
uniform vec3 uv1_scale;
uniform vec3 uv1_offset;
uniform vec3 uv2_scale;
uniform vec3 uv2_offset;

uniform sampler2D alpha_mask;


void vertex() {
	UV=UV*uv1_scale.xy+uv1_offset.xy;
	mat4 mat_world = mat4(normalize(CAMERA_MATRIX[0])*length(WORLD_MATRIX[0]),normalize(CAMERA_MATRIX[1])*length(WORLD_MATRIX[0]),normalize(CAMERA_MATRIX[2])*length(WORLD_MATRIX[2]),WORLD_MATRIX[3]);
	mat_world = mat_world * mat4( vec4(cos(INSTANCE_CUSTOM.x),-sin(INSTANCE_CUSTOM.x), 0.0, 0.0), vec4(sin(INSTANCE_CUSTOM.x), cos(INSTANCE_CUSTOM.x), 0.0, 0.0),vec4(0.0, 0.0, 1.0, 0.0),vec4(0.0, 0.0, 0.0, 1.0));
	MODELVIEW_MATRIX = INV_CAMERA_MATRIX * mat_world;
	float h_frames = float(particles_anim_h_frames);
	float v_frames = float(particles_anim_v_frames);
	float particle_total_frames = float(particles_anim_h_frames * particles_anim_v_frames);
	float particle_frame = floor(INSTANCE_CUSTOM.z * float(particle_total_frames));
	if (!particles_anim_loop) {
		particle_frame = clamp(particle_frame, 0.0, particle_total_frames - 1.0);
	} else {
		particle_frame = mod(particle_frame, particle_total_frames);
	}	UV /= vec2(h_frames, v_frames);
	UV += vec2(mod(particle_frame, h_frames) / h_frames, floor((particle_frame + 0.5) / h_frames) / v_frames);
}




void fragment() {
	vec2 base_uv = UV;
	vec4 albedo_tex = texture(texture_albedo,base_uv);
	albedo_tex *= COLOR;
	ALBEDO = albedo.rgb * albedo_tex.rgb;
	METALLIC = metallic;
	ROUGHNESS = roughness;
	SPECULAR = specular;
	ALPHA = COLOR.a * texture(alpha_mask, base_uv).x;
}
"

[sub_resource type="ShaderMaterial" id=24]
shader = SubResource( 8 )
shader_param/albedo = Color( 1, 1, 1, 1 )
shader_param/specular = 0.5
shader_param/metallic = 0.0
shader_param/roughness = 1.0
shader_param/point_size = 1.0
shader_param/particles_anim_h_frames = 1
shader_param/particles_anim_v_frames = 1
shader_param/particles_anim_loop = false
shader_param/uv1_scale = Vector3( 1, 1, 1 )
shader_param/uv1_offset = Vector3( 0, 0, 0 )
shader_param/uv2_scale = Vector3( 1, 1, 1 )
shader_param/uv2_offset = Vector3( 0, 0, 0 )
shader_param/alpha_mask = ExtResource( 7 )

[sub_resource type="QuadMesh" id=5]
material = SubResource( 24 )

[node name="Modelplant_04_Sporenpilz_state01" type="Spatial"]

[node name="Cone" type="MeshInstance" parent="."]
transform = Transform( 3.36276, 0, 0, 0, 3.36276, 0, 0, 0, 3.36276, 0.0160879, 1.09068, -0.0354233 )

[node name="Cylinder" type="MeshInstance" parent="."]
transform = Transform( 3.36276, 0, 0, 0, 3.36276, 0, 0, 0, 3.36276, -2.92901e-06, 0.0993618, 0.00952917 )
mesh = ExtResource( 1 )
material/0 = ExtResource( 3 )

[node name="Empty" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -0.0828196, 0.200395, -0.219416 )

[node name="Empty001" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -0.0368317, 0.393822, -0.112131 )

[node name="Empty002" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0.113922, 0.243402, -0.193311 )

[node name="Empty003" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0963385, 0.402765, -0.0757294 )

[node name="Empty004" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0.146744, 0.250307, 0.130228 )

[node name="Empty005" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -0.0924243, 0.182542, 0.200052 )

[node name="Empty006" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, -0.101555, 0.370345, 0.029678 )

[node name="Empty007" type="Spatial" parent="."]
transform = Transform( 1, 0, 0, 0, 1, 0, 0, 0, 1, 0.0392486, 0.41234, 0.0741057 )

[node name="SporeParticlesState01" type="Spatial" parent="."]
transform = Transform( 0.103159, 0, 0, 0, 0.062907, 0, 0, 0, 0.103159, 0, 0, 0 )
script = ExtResource( 5 )

[node name="MultiMeshInstance" type="MultiMeshInstance" parent="SporeParticlesState01"]
transform = Transform( 679.697, 0, 0, 0, 82.4584, 0, 0, 0, 338.798, 1.86817, 31.4812, -1.42611 )
multimesh = SubResource( 25 )

[node name="Particles" type="Particles" parent="SporeParticlesState01"]
transform = Transform( 3.02046, 0, 0, 0, 3.94673, 0, 0, 0, 4.46399, 0, 0, 0 )
visible = false
amount = 64
lifetime = 80.0
speed_scale = 1.2
visibility_aabb = AABB( -6.03231, -4, -4, 12.0646, 8, 8 )
process_material = SubResource( 3 )
draw_pass_1 = SubResource( 5 )

[node name="SrcMesh" type="MeshInstance" parent="SporeParticlesState01"]
transform = Transform( 0.854606, 0, 0, 0, 1.30287, 0, 0, 0, 1.13251, 13.3128, 0, 0 )
visible = false
mesh = ExtResource( 4 )

[node name="SporeShapeScatter" type="MeshInstance" parent="SporeParticlesState01"]
transform = Transform( 3.0564, 0, 0, 0, 3.0564, 0, 0, 0, 3.0564, 0, 0, 0 )
visible = false
mesh = ExtResource( 2 )
